@model IEnumerable<Library_Management_System.Models.Book>

@{
    ViewData["Title"] = "Books";
}


    <div class="d-flex justify-content-between align-items-center mb-4">
        <a href="@Url.Action("Create", "Book")" class="btn shadow-sm btn-addButton">
            <i class="bi bi-plus-lg"></i> Add Book
        </a>
    </div>

        <div class="card-body">
            <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-xl shadow-lg overflow-hidden">
        <thead  class="bg-[#4f46e5]">
            <tr>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">#</th>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">Title</th>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">Author</th>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">Category</th>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">Price</th>
                <th class="py-3 px-5 text-left text-sm font-semibold uppercase tracking-wider text-white">Published</th>
                <th class="py-3 px-5 text-center text-sm font-semibold uppercase tracking-wider text-white">Actions</th>

            </tr>
        </thead>
        <tbody class="divide-y divide-indigo-100">
            @if (Model.Any())
            {
                var index = 1;
                foreach (var book in Model)
                {
                    <tr class="transition duration-200" id="tableRow">
                        <td class="py-3 px-5 text-sm text-gray-700">@index</td>
                        <td class="py-3 px-5 text-sm text-indigo-900 font-medium">@book.Book_Name</td>
                        <td class="py-3 px-5 text-sm text-gray-800">@book.Author</td>
                        <td class="py-3 px-5 text-sm text-gray-800">@book.Category.Category_Name</td>
                        <td class="py-3 px-5 text-sm text-gray-800 font-medium">Rs.@book.Price.ToString("0.00")</td>
                        <td class="py-3 px-5 text-sm text-gray-700">@book.publication_Date?.ToString("yyyy-MM-dd")</td>
                        <td class="py-3 px-5 text-center flex justify-center gap-2">
                            <a href="@Url.Action("Edit", "Book", new { id = book.Book_id })" 
                               class="px-3 py-1 bg-yellow-400 text-white rounded-lg shadow hover:bg-yellow-500 transition">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <button type="button" onclick="deleteBook(@book.Book_id)" 
                               class="px-3 py-1 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 transition">
                                <i class="bi bi-trash-fill"></i>
                            </button>
                        </td>
                    </tr>
                    index++;
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="py-6 text-center text-gray-400 text-lg font-medium">No books available.</td>
                </tr>
            }
        </tbody>
    </table>
</div>

        </div>


@section Scripts{
<script>
    async function deleteBook(bookId) {
            const result = await Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            });

            if (!result.isConfirmed) return;

            const response = await secureFetch(`/api/book-api/Delete/${bookId}`, {
                method: 'DELETE',
            },);
            if(response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: 'Deleted!',
                    text: 'Book has been deleted.',
                    timer: 1500,
                    showConfirmButton: false
                });
                window.location.reload();
            }else{
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Something went wrong! Please try again.',
                    timer: 2000,
                    showConfirmButton: false
                });
            }
    }
</script>
}
